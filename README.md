# Взгляни в небо — Astro_helper_bot

Telegram-бот на базе aiogram, который подсказывает, что интересно наблюдать в небе, и умеет показывать погоду по координатам пользователя.

Основные возможности:
- Сохранение местоположения пользователя (через кнопку GPS)
- Получение текущей погоды по координатам (OpenWeatherMap)
- Несколько простых текстовых сообщений/команд
- Показ видимых планет, созвездий и Солнца/Луны по координатам пользователя (/sky)
- Определение направления (азимут) и высоты объектов над горизонтом
- Оценка яркости планет и звёзд, видимость невооружённым глазом
- Сообщения о световом загрязнении (уровень светового загрязнения)
- Перевод названий планет и созвездий на русский язык

## Требования
- Python 3.8+
- Библиотеки (пример):
  - aiogram
  - python-dotenv
  - requests

Рекомендуется использовать виртуальное окружение.

## Установка
1. Клонируйте репозиторий или скачайте файлы в папку проекта.
2. Создайте и активируйте виртуальное окружение:

```powershell
python -m venv .venv; .\.venv\Scripts\Activate.ps1
```

3. Установите зависимости:

```powershell
pip install aiogram python-dotenv requests
```

## Переменные окружения
Создайте файл `.env` в корне проекта и добавьте туда следующие переменные:

```
BOT_TOKEN=ваш_токен_бота_telegram
OPENWEATHER_API_KEY=ваш_api_key_openweathermap
```

Если `BOT_TOKEN` не найден в окружении, программа завершит работу с ошибкой.

## Запуск
В корне проекта запустите:

```powershell
python main.py
```

Бот будет работать в режиме polling.

## Команды бота
- /start — стартовое приветствие и кнопка отправки геопозиции
- /help — справка по основным командам
- /gps — запросить или изменить местоположение
- /weather — показать текущую погоду по сохранённым координатам

Некоторые строки текстов (сообщений) находятся в `text_messages/bot_mes.py`.

## Формат хранения координат
Координаты пользователей сохраняются в файле `users.json` в формате JSON:

```json
{
  "<user_id>": { "lat": <latitude>, "lon": <longitude> }
}
```

Пример шаблона: `users.example.json`.

## Структура проекта
- `main.py` — точка входа, чтение .env, инициализация бота и регистрация роутеров
- `handlers/userm.py` — обработчики команд и логика работы с пользователями (сохранение координат, запрос погоды)
- `text_messages/bot_mes.py` — текстовые сообщения и шаблоны для ответов
- `storage/json_work.py` — все операции с JSON (загрузка, сохранение, обновление и удаление пользователей)
- `users.json` / `users.example.json` — хранилище координат пользователей
